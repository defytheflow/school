#!/bin/bash

BASH_LIB=~/.bash_lib

MAX_LESSON_NUM=100 
LESSONS_DIR="Lessons"

# How to use this script
usage() {
	echo "Generates a default directory structure for a lesson."
	echo ""
	echo "Usage:"
	echo "  lesson [options] <num>"
	echo ""
	echo "Options:"
	echo "  -h, --help    shows a help message" 
	echo ""
	echo "Dependencies:"
	echo "  bash_lib"
	echo "  figlet"
	echo "  lolcat"
}

# Import code from ~/.bash_lib file
if [[ -f $BASH_LIB ]]; then
	. $BASH_LIB
else
	echo "Unable to find '$BASH_LIB' file. Please install it and run again"
	exit 1
fi

# Check if an option was provided
for arg in $@; do
	if [[ "$arg" =~ ^-[-]?[a-zA-Z]+$ ]]; then
		case $arg in 
			-h | --help )
				usage
				exit 0
				;;
			* )
				fatal_error "Unknown option $(reversed $arg)"
				;;
		esac
	fi	   
done

# Check if <num> argument was given
if [[ $# -lt 1 ]]; then
	usage
	echo ""
	fatal_error "Missing <num> argument"
fi

# Check if <num> argument is an integer
if [[ ! "$1" =~ ^[0-9]+$ ]]; then
	fatal_error "<num> argument must be an integer"
fi

# Check if <num> argument is less than or equal MAX_LESSON_NUM
if [[ ! "$1" -le $MAX_LESSON_NUM ]]; then
	warning "$1 exceed the MAX_LESSON_NUM"
	proceed
fi

# Check if there is already a Lesson with number <num>
if [[ -d $1 ]]; then
	fatal_error "Lesson number $(reversed $1) already exists"
fi

# Check if inside of LESSONS_DIR directory
if [[ ! "$(pwd)" =~ .+/$LESSONS_DIR$ ]]; then
	warning "Not inside $(reversed $LESSONS_DIR) directory"
	proceed
fi
# Check if figlet program is installed
if [[ ! -x "$(command -v figlet)" ]]; then
	fatal_error "$(reversed "figlet") is not installed. Please install it and run again."
fi

# Check if lolcat program is installed
if [[ ! -x "$(command -v lolcat)" ]]; then
	fatal_error "$(reversed "lolcat") is not installed. Please install it and run again."
fi

# The main job starts here

# Create the Lesson layout
mkdir $1
mkdir $1/Examples
mkdir $1/Exercises
mkdir $1/Theory
mkdir $1/Whiteboard
mkdir $1/Programs
mkdir $1/Homework

figlet "Lesson $1" | lolcat
